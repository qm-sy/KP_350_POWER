C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/04/2025 21:02:32 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\power_crl.obj
COMPILER INVOKED BY: D:\APP\Keil_STM32\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\B
                    -SP\Inc;..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl.lst) OBJECT(..\
                    -Output\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          AC_220 ac_220;
   4          
   5          /**
   6           * @brief       移相触发调用结构体初始化
   7           *
   8           * @param   
   9           *
  10           * @return  void
  11          **/
  12          void Power_Statu_Init( void )
  13          {
  14   1          ac_220.power_ch1  = 1;
  15   1          ac_220.power_ch2  = 1;
  16   1          ac_220.power_ch3  = 1;
  17   1          ac_220.power_ch4  = 1;
  18   1          ac_220.time_delay = 65500;     //默认最大输出功率
  19   1          ac_220.zero_flag  = 0;
  20   1          ac_220.AC_Statu_cnt = 0;
  21   1          ac_220.AC_Statu = 0;
  22   1      }
  23          
  24          /**
  25           * @brief       外部中断0中断处理函数
  26           *
  27           * @param   
  28           *
  29           * @return  void
  30          **/
  31          void INT0_ISR( void ) interrupt 0
  32          {
  33   1          ac_220.power_ch1 = ac_220.power_ch2 = ac_220.power_ch3 = ac_220.power_ch4 = 1;
  34   1      
  35   1          /* 1, 检测到外部中断后，等待THL\TLI后触发TIM1中断       */
  36   1          TL1 = ac_220.time_delay;                            
  37   1              TH1 = ac_220.time_delay >> 8;                           
  38   1      
  39   1          ac_220.zero_flag = 1;
  40   1          ac_220.AC_Statu_cnt = 10;
  41   1      
  42   1          /* 2, 定时器1开始计时，打开TIM1中断                     */
  43   1          TR1 = 1;                                 
  44   1          ET1 = 1; 
  45   1      }
  46          
  47          /**
  48           * @brief       Timer1中断处理函数
  49           *
  50           * @param   
  51           *
  52           * @return  void
  53          **/
C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/04/2025 21:02:32 PAGE 2   

  54          void Tim1_ISR( void ) interrupt 3   //1ms
  55          {
  56   1          /* 1, 中断触发后，power_ch电平 由高电平变为低电平           */
  57   1          if( ac_220.zero_flag == 1 )
  58   1          {
  59   2              ac_220.zero_flag = 0;
  60   2              ac_220.power_ch1 = ac_220.power_ch2 = ac_220.power_ch3 = ac_220.power_ch4 = 0;
  61   2      
  62   2               /* 2, 设置下一次Timer1中断触发所需时间，即脉冲时间       */
  63   2              TL1 = 0xF7;                             
  64   2              TH1 = 0xFF;                             
  65   2          }else
  66   1          {
  67   2              /* 3, 下一次进入Timer1中断，power_ch电平 由低电平变为高电平，完成一次10us
             -冲，即斩波*/
  68   2              ac_220.power_ch1 = ac_220.power_ch2 = ac_220.power_ch3 = ac_220.power_ch4 = 1;
  69   2      
  70   2              /* 4, 定时器1停止计时，关闭TIM1中断，等待下一次外部中断     */
  71   2              TR1 = 0;                                    
  72   2              ET1 = 0; 
  73   2          }
  74   1      }
  75          
  76          /**
  77           * @brief       220V输出功率控制函数 
  78           *
  79           * @param   power_level：输出功率百分比  0%~100%
  80           *
  81           * @return  void
  82          **/
  83          void AC_220V_out( uint8_t power_level )
  84          {
  85   1          ac_220.time_delay = 58000 + 75*power_level;
  86   1      }
  87          
  88          /**
  89           * @brief       24V LED开关控制函数
  90           *
  91           * @param   on_off：0：关闭 1：开启
  92           *
  93           * @return  void
  94          **/
  95          void DC_24V_out( uint8_t on_off )
  96          {
  97   1          if( on_off == 1)
  98   1          {
  99   2              DC_24V = 1;
 100   2          }else
 101   1          {
 102   2              DC_24V = 0;
 103   2          }
 104   1      }
 105          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    200    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      9    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/04/2025 21:02:32 PAGE 3   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
